name: Build Step

on:
  workflow_call:
    inputs:
      phpVersion:
        required: true
        type: string
      libType:
        required: true
        type: string
      testType:
        required: true
        type: string

jobs:
  test:
    name: Test ${{ inputs.testType }} ${{ inputs.phpVersion }} ${{ inputs.libType }}
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: |
          cp -p .github/.env_${{ inputs.phpVersion }}.${{ inputs.libType }}.ci .env
          touch -d '1970-01-01 00:00:00 UTC' .env
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          pattern: php-wasm-${{ inputs.libType }}-*
          path: packages/
          merge-multiple: true
      - run: npm ci
      - run: npm install -g deno
      - run: make test-${{ inputs.testType }} PHP_VERSION=${{ inputs.phpVersion }}
