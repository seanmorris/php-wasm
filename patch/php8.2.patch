diff --git a/third_party/php8.2-src/Zend/zend_atomic.h b/third_party/php8.2-src/Zend/zend_atomic.h
index 617cde0..fe9cba5 100644
--- a/third_party/php8.2-src/Zend/zend_atomic.h
+++ b/third_party/php8.2-src/Zend/zend_atomic.h
@@ -23,7 +23,7 @@
 	((__GNUC__ == (x) && __GNUC_MINOR__ >= (y)) || (__GNUC__ > (x)))
 
 /* Builtins are used to avoid library linkage */
-#if __has_feature(c_atomic)
+#if 0
 #define	HAVE_C11_ATOMICS 1
 #elif ZEND_GCC_PREREQ(4, 7)
 #define	HAVE_GNUC_ATOMICS 1
diff --git a/third_party/php8.2-src/ext/libxml/libxml.c b/third_party/php8.2-src/ext/libxml/libxml.c
index 22eb190..6089d36 100644
--- a/third_party/php8.2-src/ext/libxml/libxml.c
+++ b/third_party/php8.2-src/ext/libxml/libxml.c
@@ -49,6 +49,17 @@
 
 #include "libxml_arginfo.h"
 
+#ifdef LIBXML_DYNAMIC_LOAD
+__attribute__((weak)) const char *xmlParserVersion = {0};
+__attribute__((weak)) void (*xmlFree)(void *);
+__attribute__((weak)) void *(*xmlMalloc)(size_t);
+__attribute__((weak)) void *(*xmlMallocAtomic)(size_t);
+__attribute__((weak)) char *(*xmlMemStrdup)(const char *);
+__attribute__((weak)) void *(*xmlRealloc)(void *, size_t);
+__attribute__((weak)) void (*xmlGenericError)(void *, const char *, ...);
+__attribute__((weak)) void (*xmlStructuredError)(void *, xmlErrorPtr);
+#endif
+
 /* a true global for initialization */
 static int _php_libxml_initialized = 0;
 static int _php_libxml_per_request_initialization = 1;
@@ -788,6 +799,29 @@ PHP_LIBXML_API void php_libxml_switch_context(zval *context, zval *oldcontext)
 
 static PHP_MINIT_FUNCTION(libxml)
 {
+	if (xmlParserVersion == NULL) {
+		void *handle = DL_LOAD("libxml2.so");
+		const char** xmlParserVersionPtr = (const char**)dlsym(handle, "xmlParserVersion");
+		if (xmlParserVersionPtr) {
+			xmlParserVersion = *xmlParserVersionPtr;
+		}
+	}
+
+	if (xmlParserVersion == NULL) {
+		zend_disable_class("LibXMLError", sizeof("LibXMLError") - 1);
+		zend_disable_functions(
+			"libxml_set_streams_context,"
+			"libxml_use_internal_errors,"
+			"libxml_get_last_error,"
+			"libxml_get_errors,"
+			"libxml_clear_errors,"
+			"libxml_disable_entity_loader,"
+			"libxml_set_external_entity_loader,"
+			"libxml_get_external_entity_loader,"
+		);
+		return SUCCESS;
+	}
+
 	php_libxml_initialize();
 
 	register_libxml_symbols(module_number);
@@ -823,6 +857,8 @@ static PHP_MINIT_FUNCTION(libxml)
 
 static PHP_RINIT_FUNCTION(libxml)
 {
+	if (xmlParserVersion == NULL) return SUCCESS;
+
 	if (_php_libxml_per_request_initialization) {
 		/* report errors via handler rather than stderr */
 		xmlSetGenericErrorFunc(NULL, php_libxml_error_handler);
@@ -841,6 +877,8 @@ static PHP_RINIT_FUNCTION(libxml)
 
 static PHP_RSHUTDOWN_FUNCTION(libxml)
 {
+	if (xmlParserVersion == NULL) return SUCCESS;
+
 	LIBXML(entity_loader).fci.size = 0;
 	zval_ptr_dtor_nogc(&LIBXML(entity_loader).callback);
 	ZVAL_NULL(&LIBXML(entity_loader).callback);
@@ -850,6 +888,8 @@ static PHP_RSHUTDOWN_FUNCTION(libxml)
 
 static PHP_MSHUTDOWN_FUNCTION(libxml)
 {
+	if (xmlParserVersion == NULL) return SUCCESS;
+
 	if (!_php_libxml_per_request_initialization) {
 		xmlSetGenericErrorFunc(NULL, NULL);
 
@@ -863,6 +903,8 @@ static PHP_MSHUTDOWN_FUNCTION(libxml)
 
 static zend_result php_libxml_post_deactivate(void)
 {
+	if (xmlParserVersion == NULL) return SUCCESS;
+
 	/* reset libxml generic error handling */
 	if (_php_libxml_per_request_initialization) {
 		xmlSetGenericErrorFunc(NULL, NULL);
@@ -888,6 +930,13 @@ static zend_result php_libxml_post_deactivate(void)
 
 static PHP_MINFO_FUNCTION(libxml)
 {
+	if (xmlParserVersion == NULL) {
+		php_info_print_table_start();
+		php_info_print_table_row(2, "libXML support", "NOT ACTIVE");
+		php_info_print_table_end();
+		return;
+	}
+
 	php_info_print_table_start();
 	php_info_print_table_row(2, "libXML support", "active");
 	php_info_print_table_row(2, "libXML Compiled Version", LIBXML_DOTTED_VERSION);
@@ -900,6 +949,8 @@ static PHP_MINFO_FUNCTION(libxml)
 /* {{{ Set the streams context for the next libxml document load or write */
 PHP_FUNCTION(libxml_set_streams_context)
 {
+	if (xmlParserVersion == NULL) return;
+
 	zval *arg;
 
 	ZEND_PARSE_PARAMETERS_START(1, 1)
@@ -917,6 +968,8 @@ PHP_FUNCTION(libxml_set_streams_context)
 /* {{{ Disable libxml errors and allow user to fetch error information as needed */
 PHP_FUNCTION(libxml_use_internal_errors)
 {
+	if (xmlParserVersion == NULL) return;
+
 	xmlStructuredErrorFunc current_handler;
 	bool use_errors, use_errors_is_null = 1, retval;
 
@@ -957,6 +1010,8 @@ PHP_FUNCTION(libxml_use_internal_errors)
 /* {{{ Retrieve last error from libxml */
 PHP_FUNCTION(libxml_get_last_error)
 {
+	if (xmlParserVersion == NULL) return;
+
 	xmlErrorPtr error;
 
 	ZEND_PARSE_PARAMETERS_NONE();
@@ -988,6 +1043,7 @@ PHP_FUNCTION(libxml_get_last_error)
 /* {{{ Retrieve array of errors */
 PHP_FUNCTION(libxml_get_errors)
 {
+	if (xmlParserVersion == NULL) return;
 
 	xmlErrorPtr error;
 
@@ -1029,6 +1085,8 @@ PHP_FUNCTION(libxml_get_errors)
 /* {{{ Clear last error from libxml */
 PHP_FUNCTION(libxml_clear_errors)
 {
+	if (xmlParserVersion == NULL) return;
+
 	ZEND_PARSE_PARAMETERS_NONE();
 
 	xmlResetLastError();
@@ -1049,6 +1107,8 @@ PHP_LIBXML_API bool php_libxml_disable_entity_loader(bool disable) /* {{{ */
 /* {{{ Disable/Enable ability to load external entities */
 PHP_FUNCTION(libxml_disable_entity_loader)
 {
+	if (xmlParserVersion == NULL) return;
+
 	bool disable = 1;
 
 	ZEND_PARSE_PARAMETERS_START(0, 1)
@@ -1063,6 +1123,8 @@ PHP_FUNCTION(libxml_disable_entity_loader)
 /* {{{ Changes the default external entity loader */
 PHP_FUNCTION(libxml_set_external_entity_loader)
 {
+	if (xmlParserVersion == NULL) return;
+
 	zval					*callback;
 	zend_fcall_info			fci;
 	zend_fcall_info_cache	fcc;
@@ -1088,6 +1150,8 @@ PHP_FUNCTION(libxml_set_external_entity_loader)
 /* {{{ Get the current external entity loader, or null if the default loader is installer. */
 PHP_FUNCTION(libxml_get_external_entity_loader)
 {
+	if (xmlParserVersion == NULL) return;
+
 	ZEND_PARSE_PARAMETERS_NONE();
 	RETURN_COPY(&LIBXML(entity_loader).callback);
 }
diff --git a/third_party/php8.2-src/ext/openssl/openssl.c b/third_party/php8.2-src/ext/openssl/openssl.c
index f9c7f8c..2219409 100644
--- a/third_party/php8.2-src/ext/openssl/openssl.c
+++ b/third_party/php8.2-src/ext/openssl/openssl.c
@@ -1277,8 +1277,8 @@ PHP_MINIT_FUNCTION(openssl)
 	/* override the default tcp socket provider */
 	php_stream_xport_register("tcp", php_openssl_ssl_socket_factory);
 
-	php_register_url_stream_wrapper("https", &php_stream_http_wrapper);
-	php_register_url_stream_wrapper("ftps", &php_stream_ftp_wrapper);
+	// php_register_url_stream_wrapper("https", &php_stream_http_wrapper);
+	// php_register_url_stream_wrapper("ftps", &php_stream_ftp_wrapper);
 
 	REGISTER_INI_ENTRIES();
 
diff --git a/third_party/php8.2-src/ext/pdo/config.m4 b/third_party/php8.2-src/ext/pdo/config.m4
index 9b9a3e3..1148123 100644
--- a/third_party/php8.2-src/ext/pdo/config.m4
+++ b/third_party/php8.2-src/ext/pdo/config.m4
@@ -4,15 +4,14 @@ PHP_ARG_ENABLE([pdo],
     [Disable PHP Data Objects support])],
   [yes])
 
-if test "$PHP_PDO" != "no"; then
-
-  dnl Make sure $PHP_PDO is 'yes' when it's not 'no' :)
-  PHP_PDO=yes
+dnl Make sure $PHP_PDO is 'yes' when it's not 'no' :)
+PHP_PDO=yes
 
+if test "$PHP_PDO" != "no"; then
+  dnl so we always include the known-good working hack.
   PHP_NEW_EXTENSION(pdo, pdo.c pdo_dbh.c pdo_stmt.c pdo_sql_parser.c pdo_sqlstate.c, $ext_shared)
   PHP_ADD_EXTENSION_DEP(pdo, spl, true)
   PHP_INSTALL_HEADERS(ext/pdo, [php_pdo.h php_pdo_driver.h php_pdo_error.h])
 
-  dnl so we always include the known-good working hack.
   PHP_ADD_MAKEFILE_FRAGMENT
 fi
diff --git a/third_party/php8.2-src/ext/pdo_sqlite/config.m4 b/third_party/php8.2-src/ext/pdo_sqlite/config.m4
index 64311ea..57cfa19 100644
--- a/third_party/php8.2-src/ext/pdo_sqlite/config.m4
+++ b/third_party/php8.2-src/ext/pdo_sqlite/config.m4
@@ -10,25 +10,8 @@ if test "$PHP_PDO_SQLITE" != "no"; then
     AC_MSG_ERROR([PDO is not enabled! Add --enable-pdo to your configure line.])
   fi
 
-  PHP_CHECK_PDO_INCLUDES
-
-  PKG_CHECK_MODULES([SQLITE], [sqlite3 >= 3.7.7])
-
-  PHP_EVAL_INCLINE($SQLITE_CFLAGS)
-  PHP_EVAL_LIBLINE($SQLITE_LIBS, PDO_SQLITE_SHARED_LIBADD)
-  AC_DEFINE(HAVE_PDO_SQLITELIB, 1, [Define to 1 if you have the pdo_sqlite extension enabled.])
-
-  PHP_CHECK_LIBRARY(sqlite3, sqlite3_close_v2, [
-    AC_DEFINE(HAVE_SQLITE3_CLOSE_V2, 1, [have sqlite3_close_v2])
-  ], [], [$PDO_SQLITE_SHARED_LIBADD])
-
-  PHP_CHECK_LIBRARY(sqlite3, sqlite3_column_table_name, [
-    AC_DEFINE(HAVE_SQLITE3_COLUMN_TABLE_NAME, 1, [have sqlite3_column_table_name])
-  ], [], [$PDO_SQLITE_SHARED_LIBADD])
-
-  PHP_SUBST(PDO_SQLITE_SHARED_LIBADD)
   PHP_NEW_EXTENSION(pdo_sqlite, pdo_sqlite.c sqlite_driver.c sqlite_statement.c,
-    $ext_shared,,-I$pdo_cv_inc_path)
+    $ext_shared,,)
 
   PHP_ADD_EXTENSION_DEP(pdo_sqlite, pdo)
 fi
diff --git a/third_party/php8.2-src/ext/pdo_sqlite/pdo_sqlite.c b/third_party/php8.2-src/ext/pdo_sqlite/pdo_sqlite.c
index 81761b1..0942423 100644
--- a/third_party/php8.2-src/ext/pdo_sqlite/pdo_sqlite.c
+++ b/third_party/php8.2-src/ext/pdo_sqlite/pdo_sqlite.c
@@ -21,8 +21,8 @@
 #include "php.h"
 #include "php_ini.h"
 #include "ext/standard/info.h"
-#include "pdo/php_pdo.h"
-#include "pdo/php_pdo_driver.h"
+#include "../pdo/php_pdo.h"
+#include "../pdo/php_pdo_driver.h"
 #include "php_pdo_sqlite.h"
 #include "php_pdo_sqlite_int.h"
 #include "zend_exceptions.h"
diff --git a/third_party/php8.2-src/ext/pdo_sqlite/sqlite_driver.c b/third_party/php8.2-src/ext/pdo_sqlite/sqlite_driver.c
index de5170a..2ea31b6 100644
--- a/third_party/php8.2-src/ext/pdo_sqlite/sqlite_driver.c
+++ b/third_party/php8.2-src/ext/pdo_sqlite/sqlite_driver.c
@@ -21,8 +21,8 @@
 #include "php.h"
 #include "php_ini.h"
 #include "ext/standard/info.h"
-#include "pdo/php_pdo.h"
-#include "pdo/php_pdo_driver.h"
+#include "../pdo/php_pdo.h"
+#include "../pdo/php_pdo_driver.h"
 #include "php_pdo_sqlite.h"
 #include "php_pdo_sqlite_int.h"
 #include "zend_exceptions.h"
diff --git a/third_party/php8.2-src/ext/pdo_sqlite/sqlite_statement.c b/third_party/php8.2-src/ext/pdo_sqlite/sqlite_statement.c
index 90de059..8dc0ad3 100644
--- a/third_party/php8.2-src/ext/pdo_sqlite/sqlite_statement.c
+++ b/third_party/php8.2-src/ext/pdo_sqlite/sqlite_statement.c
@@ -21,8 +21,8 @@
 #include "php.h"
 #include "php_ini.h"
 #include "ext/standard/info.h"
-#include "pdo/php_pdo.h"
-#include "pdo/php_pdo_driver.h"
+#include "../pdo/php_pdo.h"
+#include "../pdo/php_pdo_driver.h"
 #include "php_pdo_sqlite.h"
 #include "php_pdo_sqlite_int.h"
 
diff --git a/third_party/php8.2-src/ext/sqlite3/config0.m4 b/third_party/php8.2-src/ext/sqlite3/config0.m4
index 2373d13..b94508f 100644
--- a/third_party/php8.2-src/ext/sqlite3/config0.m4
+++ b/third_party/php8.2-src/ext/sqlite3/config0.m4
@@ -5,26 +5,6 @@ PHP_ARG_WITH([sqlite3],
   [yes])
 
 if test $PHP_SQLITE3 != "no"; then
-  PKG_CHECK_MODULES([SQLITE], [sqlite3 >= 3.7.7])
-
-  PHP_EVAL_INCLINE($SQLITE_CFLAGS)
-  PHP_EVAL_LIBLINE($SQLITE_LIBS, SQLITE3_SHARED_LIBADD)
-  AC_DEFINE(HAVE_SQLITE3, 1, [Define to 1 if you have the sqlite3 extension enabled.])
-
-  PHP_CHECK_LIBRARY(sqlite3, sqlite3_errstr, [
-    AC_DEFINE(HAVE_SQLITE3_ERRSTR, 1, [have sqlite3_errstr function])
-  ], [], [$SQLITE3_SHARED_LIBADD])
-
-  PHP_CHECK_LIBRARY(sqlite3, sqlite3_expanded_sql, [
-    AC_DEFINE(HAVE_SQLITE3_EXPANDED_SQL, 1, [have sqlite3_expanded_sql function])
-  ], [], [$SQLITE3_SHARED_LIBADD])
-
-  PHP_CHECK_LIBRARY(sqlite3,sqlite3_load_extension,
-    [],
-    [AC_DEFINE(SQLITE_OMIT_LOAD_EXTENSION, 1, [have sqlite3 with extension support])],
-    [$SQLITE3_SHARED_LIBADD]
-  )
-
   PHP_NEW_EXTENSION(sqlite3, sqlite3.c, $ext_shared,,-DZEND_ENABLE_STATIC_TSRMLS_CACHE=1)
   PHP_SUBST(SQLITE3_SHARED_LIBADD)
 fi
diff --git a/third_party/php8.2-src/ext/standard/basic_functions.c b/third_party/php8.2-src/ext/standard/basic_functions.c
index 6967307..d3601f6 100755
--- a/third_party/php8.2-src/ext/standard/basic_functions.c
+++ b/third_party/php8.2-src/ext/standard/basic_functions.c
@@ -355,8 +355,8 @@ PHP_MINIT_FUNCTION(basic) /* {{{ */
 	php_register_url_stream_wrapper("glob", &php_glob_stream_wrapper);
 #endif
 	php_register_url_stream_wrapper("data", &php_stream_rfc2397_wrapper);
-	php_register_url_stream_wrapper("http", &php_stream_http_wrapper);
-	php_register_url_stream_wrapper("ftp", &php_stream_ftp_wrapper);
+	// php_register_url_stream_wrapper("http", &php_stream_http_wrapper);
+	// php_register_url_stream_wrapper("ftp", &php_stream_ftp_wrapper);
 
 	BASIC_MINIT_SUBMODULE(hrtime)
 
diff --git a/third_party/php8.2-src/ext/standard/credits.c b/third_party/php8.2-src/ext/standard/credits.c
index 4e8722d..1343330 100644
--- a/third_party/php8.2-src/ext/standard/credits.c
+++ b/third_party/php8.2-src/ext/standard/credits.c
@@ -33,6 +33,11 @@ PHPAPI ZEND_COLD void php_print_credits(int flag) /* {{{ */
 		PUTS("PHP Credits\n");
 	}
 
+	php_info_print_table_start();
+	php_info_print_table_header(1, "php-wasm");
+	php_info_print_table_row(1, "Sean Morris & Oraoto");
+	php_info_print_table_end();
+
 	if (flag & PHP_CREDITS_GROUP) {
 		/* Group */
 
diff --git a/third_party/php8.2-src/ext/tokenizer/tokenizer.c b/third_party/php8.2-src/ext/tokenizer/tokenizer.c
index 20124db..33327c1 100644
--- a/third_party/php8.2-src/ext/tokenizer/tokenizer.c
+++ b/third_party/php8.2-src/ext/tokenizer/tokenizer.c
@@ -319,7 +319,7 @@ static void add_token(
 	zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &token);
 }
 
-static bool tokenize(zval *return_value, zend_string *source, zend_class_entry *token_class)
+bool tokenize(zval *return_value, zend_string *source, zend_class_entry *token_class)
 {
 	zval source_zval;
 	zend_lex_state original_lex_state;
diff --git a/third_party/php8.2-src/main/fastcgi.c b/third_party/php8.2-src/main/fastcgi.c
index a77491f..7f9778f 100644
--- a/third_party/php8.2-src/main/fastcgi.c
+++ b/third_party/php8.2-src/main/fastcgi.c
@@ -553,6 +553,7 @@ void fcgi_shutdown(void)
 {
 	if (is_initialized) {
 		zend_hash_destroy(&fcgi_mgmt_vars);
+		is_initialized = 0;
 	}
 	is_fastcgi = 0;
 	if (allowed_clients) {
diff --git a/third_party/php8.2-src/sapi/cgi/Makefile.frag b/third_party/php8.2-src/sapi/cgi/Makefile.frag
index 79e2afe..0956f43 100644
--- a/third_party/php8.2-src/sapi/cgi/Makefile.frag
+++ b/third_party/php8.2-src/sapi/cgi/Makefile.frag
@@ -1,7 +1,7 @@
 cgi: $(SAPI_CGI_PATH)
 
 $(SAPI_CGI_PATH): $(PHP_GLOBAL_OBJS) $(PHP_BINARY_OBJS) $(PHP_FASTCGI_OBJS) $(PHP_CGI_OBJS)
-	$(BUILD_CGI)
+	$(BUILD_CGI) $(WASM_SHARED_LIBS)
 
 install-cgi: $(SAPI_CGI_PATH)
 	@echo "Installing PHP CGI binary:        $(INSTALL_ROOT)$(bindir)/"
diff --git a/third_party/php8.2-src/sapi/cgi/cgi_main.c b/third_party/php8.2-src/sapi/cgi/cgi_main.c
index b454680..e98bf3e 100644
--- a/third_party/php8.2-src/sapi/cgi/cgi_main.c
+++ b/third_party/php8.2-src/sapi/cgi/cgi_main.c
@@ -18,7 +18,7 @@
    |          Dmitry Stogov <dmitry@php.net>                              |
    +----------------------------------------------------------------------+
 */
-
+#include <emscripten.h>
 #include "php.h"
 #include "php_globals.h"
 #include "php_variables.h"
@@ -1858,7 +1858,8 @@ int main(int argc, char *argv[])
 	SG(request_info).path_translated = NULL;
 #endif
 
-	cgi_sapi_module.executable_location = argv[0];
+	// cgi_sapi_module.executable_location = argv[0];
+	cgi_sapi_module.executable_location = NULL;
 	if (!cgi && !fastcgi && !bindpath) {
 		cgi_sapi_module.additional_functions = additional_functions;
 	}
@@ -1934,8 +1935,10 @@ consult the installation file that came with this distribution, or visit \n\
 	}
 
 	/* make php call us to get _ENV vars */
-	php_php_import_environment_variables = php_import_environment_variables;
-	php_import_environment_variables = cgi_php_import_environment_variables;
+	if(php_import_environment_variables != cgi_php_import_environment_variables) {
+		php_php_import_environment_variables = php_import_environment_variables;
+		php_import_environment_variables = cgi_php_import_environment_variables;
+	}
 
 	if (fastcgi) {
 		/* How many times to run PHP scripts before dying */
@@ -2640,3 +2643,18 @@ consult the installation file that came with this distribution, or visit \n\
 	return exit_status;
 }
 /* }}} */
+
+void EMSCRIPTEN_KEEPALIVE wasm_sapi_cgi_init(void)
+{
+	putenv("USE_ZEND_ALLOC=0");
+}
+
+char* EMSCRIPTEN_KEEPALIVE wasm_sapi_cgi_getenv(char *name)
+{
+	return getenv(name);
+}
+
+char* EMSCRIPTEN_KEEPALIVE wasm_sapi_cgi_putenv(char *name, char *value)
+{
+	return _sapi_cgi_putenv(name, strlen(name), value);
+}
diff --git a/third_party/php8.2-src/sapi/cli/Makefile.frag b/third_party/php8.2-src/sapi/cli/Makefile.frag
index aa1d642..649533d 100644
--- a/third_party/php8.2-src/sapi/cli/Makefile.frag
+++ b/third_party/php8.2-src/sapi/cli/Makefile.frag
@@ -1,7 +1,7 @@
 cli: $(SAPI_CLI_PATH)
 
 $(SAPI_CLI_PATH): $(PHP_GLOBAL_OBJS) $(PHP_BINARY_OBJS) $(PHP_CLI_OBJS)
-	$(BUILD_CLI)
+	$(BUILD_CLI) $(WASM_SHARED_LIBS)
 
 install-cli: $(SAPI_CLI_PATH)
 	@echo "Installing PHP CLI binary:        $(INSTALL_ROOT)$(bindir)/"
diff --git a/third_party/php8.2-src/sapi/embed/php_embed.c b/third_party/php8.2-src/sapi/embed/php_embed.c
index 4b94bd9..fc44d30 100644
--- a/third_party/php8.2-src/sapi/embed/php_embed.c
+++ b/third_party/php8.2-src/sapi/embed/php_embed.c
@@ -243,8 +243,8 @@ EMBED_SAPI_API int php_embed_init(int argc, char **argv)
 		return FAILURE;
 	}
 
-	SG(headers_sent) = 1;
-	SG(request_info).no_headers = 1;
+	SG(headers_sent) = 0;
+	SG(request_info).no_headers = 0;
 	php_register_variable("PHP_SELF", "-", NULL);
 
 	return SUCCESS;
diff --git a/third_party/php8.2-src/sapi/phpdbg/Makefile.frag b/third_party/php8.2-src/sapi/phpdbg/Makefile.frag
index 2e2faf80..9cbb0486 100644
--- a/third_party/php8.2-src/sapi/phpdbg/Makefile.frag
+++ b/third_party/php8.2-src/sapi/phpdbg/Makefile.frag
@@ -6,7 +6,7 @@ $(BUILD_SHARED): $(PHP_GLOBAL_OBJS) $(PHP_BINARY_OBJS) $(PHP_PHPDBG_OBJS)
 	$(BUILD_PHPDBG_SHARED)
 
 $(BUILD_BINARY): $(PHP_GLOBAL_OBJS) $(PHP_BINARY_OBJS) $(PHP_PHPDBG_OBJS)
-	$(BUILD_PHPDBG)
+	$(BUILD_PHPDBG) $(WASM_SHARED_LIBS)
 
 %.c: %.y
 %.c: %.l
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg.c
index d4ffcdf..9b1b339 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg.c
@@ -16,6 +16,8 @@
    +----------------------------------------------------------------------+
 */
 
+#include  <emscripten.h>
+
 #include "phpdbg.h"
 #include "phpdbg_prompt.h"
 #include "phpdbg_bp.h"
@@ -148,6 +150,24 @@ static inline void php_phpdbg_globals_ctor(zend_phpdbg_globals *pg) /* {{{ */
 #endif
 } /* }}} */
 
+const char* phpdbg_wasm_current_file = NULL;
+uint32_t phpdbg_wasm_current_line = NULL;
+
+const char** EMSCRIPTEN_KEEPALIVE phpdbg_wasm_get_current_file(void)
+{
+	return &phpdbg_wasm_current_file;
+}
+
+uint32_t* EMSCRIPTEN_KEEPALIVE phpdbg_wasm_get_current_line(void)
+{
+	return &phpdbg_wasm_current_line;
+}
+
+int* EMSCRIPTEN_KEEPALIVE php_wasm_get_bpcount(void)
+{
+	return &PHPDBG_G(bp_count);
+}
+
 static PHP_MINIT_FUNCTION(phpdbg) /* {{{ */
 {
 	zend_hash_init(&PHPDBG_G(bp)[PHPDBG_BREAK_FILE], 8, NULL, php_phpdbg_destroy_bp_file, 0);
@@ -177,6 +197,9 @@ static PHP_MINIT_FUNCTION(phpdbg) /* {{{ */
 
 static PHP_MSHUTDOWN_FUNCTION(phpdbg) /* {{{ */
 {
+	phpdbg_wasm_current_file = NULL;
+	phpdbg_wasm_current_line = NULL;
+
 	zend_hash_destroy(&PHPDBG_G(registered));
 	phpdbg_destroy_watchpoints();
 
@@ -1118,7 +1141,7 @@ php_stream *phpdbg_stream_url_wrap_php(php_stream_wrapper *wrapper, const char *
 	return PHPDBG_G(orig_url_wrap_php)->wops->stream_opener(wrapper, path, mode, options, opened_path, context STREAMS_CC);
 } /* }}} */
 
-int main(int argc, char **argv) /* {{{ */
+int EMSCRIPTEN_KEEPALIVE main(int argc, char **argv) /* {{{ */
 {
 	sapi_module_struct *phpdbg = &phpdbg_sapi_module;
 	char *sapi_name;
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg.h b/third_party/php8.2-src/sapi/phpdbg/phpdbg.h
index 76630dc..ecfe515 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg.h
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg.h
@@ -182,7 +182,7 @@ int phpdbg_do_parse(phpdbg_param_t *stack, char *input);
 #ifndef _WIN32
 #	define PHPDBG_DEFAULT_FLAGS (PHPDBG_IS_QUIET | PHPDBG_IS_COLOURED | PHPDBG_IS_BP_ENABLED | PHPDBG_HAS_PAGINATION)
 #else
-#	define PHPDBG_DEFAULT_FLAGS (PHPDBG_IS_QUIET | PHPDBG_IS_BP_ENABLED | PHPDBG_HAS_PAGINATION)
+#	define PHPDBG_DEFAULT_FLAGS (PHPDBG_IS_QUIET | PHPDBG_IS_BP_ENABLED )
 #endif /* }}} */
 
 /* {{{ output descriptors */
@@ -310,4 +310,7 @@ ZEND_BEGIN_MODULE_GLOBALS(phpdbg)
 	zend_ulong lines;                                  /* max number of lines to display */
 ZEND_END_MODULE_GLOBALS(phpdbg) /* }}} */
 
+extern const char* phpdbg_wasm_current_file;
+extern uint32_t phpdbg_wasm_current_line;
+
 #endif /* PHPDBG_H */
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg_cmd.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg_cmd.c
index 7e6a87f..f4e01e3 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg_cmd.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg_cmd.c
@@ -757,7 +757,7 @@ PHPDBG_API char *phpdbg_read_input(const char *buffered) /* {{{ */
 			buffer = estrdup(cmd);
 			free(cmd);
 #else
-			phpdbg_write("%s", phpdbg_get_prompt());
+			// phpdbg_write("%s", phpdbg_get_prompt());
 			phpdbg_consume_stdin_line(buf);
 			buffer = estrdup(buf);
 #endif
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg_info.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg_info.c
index 0a1e757..a3d53cb 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg_info.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg_info.c
@@ -159,7 +159,7 @@ PHPDBG_INFO(constants) /* {{{ */
 	return SUCCESS;
 } /* }}} */
 
-static int phpdbg_arm_auto_global(zval *ptrzv) {
+int phpdbg_arm_auto_global(zval *ptrzv) {
 	zend_auto_global *auto_global = Z_PTR_P(ptrzv);
 
 	if (auto_global->armed) {
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg_io.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg_io.c
index 14ae71a..8163757 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg_io.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg_io.c
@@ -14,6 +14,8 @@
    +----------------------------------------------------------------------+
 */
 
+#include  <emscripten.h>
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -22,52 +24,40 @@
 
 ZEND_EXTERN_MODULE_GLOBALS(phpdbg)
 
-/* is easy to generalize ... but not needed for now */
-PHPDBG_API int phpdbg_consume_stdin_line(char *buf) {
-	int bytes = PHPDBG_G(input_buflen), len = 0;
+EM_ASYNC_JS(int, phpdbg_internal_consume_stdin_line, (char *buf, int max_length), {
+
+	let input;
+
+	Module.triggerStdin();
 
-	if (PHPDBG_G(input_buflen)) {
-		memcpy(buf, PHPDBG_G(input_buffer), bytes);
+	if(Module.inputDataQueue.length)
+	{
+		input = String(Module.inputDataQueue.shift());
+	}
+	else
+	{
+		let a, r;
+		const promise = new Promise((accept, reject) => [a, r] = [ accept, reject ]);
+		Module.awaitingInput = a;
+		input = String(await promise);
 	}
 
-	PHPDBG_G(last_was_newline) = 1;
+	if(input.length >= max_length)
+	{
+		input = input.slice(0, max_length - 1);
+	}
 
-	do {
-		int i;
-		if (bytes <= 0) {
-			continue;
-		}
+	stringToUTF8(input, buf, input.length + 1);
 
-		for (i = len; i < len + bytes; i++) {
-			if (buf[i] == '\x03') {
-				if (i != len + bytes - 1) {
-					memmove(buf + i, buf + i + 1, len + bytes - i - 1);
-				}
-				len--;
-				i--;
-				continue;
-			}
-			if (buf[i] == '\n') {
-				PHPDBG_G(input_buflen) = len + bytes - 1 - i;
-				if (PHPDBG_G(input_buflen)) {
-					memcpy(PHPDBG_G(input_buffer), buf + i + 1, PHPDBG_G(input_buflen));
-				}
-				if (i != PHPDBG_MAX_CMD - 1) {
-					buf[i + 1] = 0;
-				}
-				return i;
-			}
-		}
 
-		len += bytes;
-	} while ((bytes = phpdbg_mixed_read(PHPDBG_G(io)[PHPDBG_STDIN].fd, buf + len, PHPDBG_MAX_CMD - len, -1)) > 0);
 
-	if (bytes <= 0) {
-		PHPDBG_G(flags) |= PHPDBG_IS_QUITTING;
-		zend_bailout();
-	}
+	return input.length;
+});
 
-	return bytes;
+
+/* is easy to generalize ... but not needed for now */
+PHPDBG_API int phpdbg_consume_stdin_line(char *buf) {
+	return phpdbg_internal_consume_stdin_line(buf, PHPDBG_MAX_CMD);
 }
 
 PHPDBG_API int phpdbg_mixed_read(int fd, char *ptr, int len, int tmo) {
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg_prompt.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg_prompt.c
index 2464e39..533e118 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg_prompt.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg_prompt.c
@@ -1655,6 +1655,8 @@ void phpdbg_execute_ex(zend_execute_data *execute_data) /* {{{ */
 	PHPDBG_G(in_execution) = 1;
 
 	while (1) {
+		phpdbg_wasm_current_file = zend_get_executed_filename();
+		phpdbg_wasm_current_line = zend_get_executed_lineno();
 		zend_object *exception = EG(exception);
 
 		if ((PHPDBG_G(flags) & PHPDBG_BP_RESOLVE_MASK)) {
diff --git a/third_party/php8.2-src/sapi/phpdbg/phpdbg_utils.c b/third_party/php8.2-src/sapi/phpdbg/phpdbg_utils.c
index f638d60..4c50f0f 100644
--- a/third_party/php8.2-src/sapi/phpdbg/phpdbg_utils.c
+++ b/third_party/php8.2-src/sapi/phpdbg/phpdbg_utils.c
@@ -16,6 +16,8 @@
    +----------------------------------------------------------------------+
 */
 
+#include <emscripten.h>
+
 #include "zend.h"
 
 #include "php.h"
@@ -293,7 +295,7 @@ PHPDBG_API void phpdbg_set_prompt(const char *prompt) /* {{{ */
 	PHPDBG_G(prompt)[0] = strdup(prompt);
 } /* }}} */
 
-PHPDBG_API const char *phpdbg_get_prompt(void) /* {{{ */
+PHPDBG_API const char EMSCRIPTEN_KEEPALIVE *phpdbg_get_prompt(void) /* {{{ */
 {
 	/* find cached prompt */
 	if (PHPDBG_G(prompt)[1]) {
